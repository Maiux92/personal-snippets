<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Snippets</title>
    <link href="assets/bootstrap-5.3.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/fontawesome-free-6.7.2-web/css/fontawesome.min.css" rel="stylesheet">
    <link href="assets/fontawesome-free-6.7.2-web/css/solid.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/highlight.js-11.10.0/styles/default.min.css">
    <link rel="stylesheet" href="assets/style.css">

</head>
<body class="bg-light d-flex justify-content-center">
    <div id="app" class="container mt-5 bg-white rounded shadow">
        <!-- Modal for Viewing Snippet -->
        <div class="modal fade" tabindex="-1" id="viewModal">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ viewSnippet.title }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="position-relative">
                            <div class="position-absolute top-0 end-0 p-2 language-box">
                                {{ viewSnippet.language }}
                            </div>
                            <div id="content"></div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <div>
                            <a class="btn btn-success btn-sm" :href="'api.php?dw=' + viewSnippet.id"><i class="fas fa-solid fa-download"></i></a>
                            <button class="btn btn-warning btn-sm" @click="$('#viewModal').modal('hide'); showEditModal(viewSnippet)"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm" @click="$('#viewModal').modal('hide'); confirmDelete(viewSnippet)"><i class="fas fa-trash-alt"></i></button>
                        </div>
                        <span><strong><i class="fas fa-edit"></i></strong> {{ viewSnippet.updated_at }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for Creating Snippet -->
        <div class="modal fade" tabindex="-1" id="createModal">
            <div class="modal-dialog modal-lg" role="document">
                <form @submit.prevent="createSnippet">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Create Snippet</h3>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="snippetTitle"><h5>Title</h5></label>
                                        <input type="text" v-model="newSnippet.title" class="form-control" :class="{'is-invalid': formError.title}" placeholder="Snippet title" required>
                                        <div class="invalid-feedback" v-if="formError.title">{{ formError.title }}</div>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="snippetLanguage"><h5>Language</h5></label>
                                        <select v-model="newSnippet.language" class="form-select" required>
                                            <option v-for="language in hljsLanguages" :value="language">{{ language }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="form-group col-12">
                                        <label for="snippetContent"><h5>Content</h5></label>
                                        <div class="textarea-with-line-numbers">
                                          <div class="textarea-line-numbers"></div>
                                          <textarea v-model="newSnippet.content" class="form-control fancy-textarea" required></textarea>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <div class="modal-footer text-end">
                            <button type="submit" class="btn btn-primary" :disabled="isTitleDuplicate"><i class="fas fa-solid fa-pen-to-square"></i>&nbsp;&nbsp;Create</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal for Editing Snippet -->
        <div class="modal fade" tabindex="-1" id="editModal">
            <div class="modal-dialog modal-lg" role="document">
                <form @submit.prevent="editSnippet">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Snippet</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <label for="editSnippetTitle"><h5>Title</h5></label>
                                        <input @input="isTitleDuplicateEdit" type="text" v-model="editSnippetData.title" class="form-control" :class="{'is-invalid': formError.title}" placeholde="Snippet title" required>
                                        <div class="invalid-feedback" v-if="formError.title">{{ formError.title }}</div>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="editSnippetLanguage"><h5>Language</h5></label>
                                        <select v-model="editSnippetData.language" class="form-select" required>
                                            <option v-for="language in hljsLanguages" :value="language">{{ language }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="form-group col-12">
                                        <label for="editSnippetContent">Content</label>
                                        <div class="textarea-with-line-numbers" id="editTextArea">
                                          <div class="textarea-line-numbers"></div>
                                          <textarea v-model="editSnippetData.content" class="form-control fancy-textarea" required></textarea>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <div class="modal-footer justify-content-between">
                            <div>
                                <a class="btn btn-success" :href="'api.php?dw=' + editSnippetData.id"><i class="fas fa-solid fa-download"></i></a>
                                <button type="button" class="btn btn-danger text-start" style="margin-right: 2px;" @click="$('#editModal').modal('hide'); confirmDelete(editSnippetData);"><i class="fas fa-trash-alt"></i></button>
                            </div>
                            <button type="submit" class="btn btn-primary" :disabled="isTitleDuplicateEdit"><i class="fas fa-solid fa-floppy-disk"></i>&nbsp;&nbsp;Save</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal for Deleting Snippet -->
        <div class="modal fade" tabindex="-1" id="deleteModal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Delete Snippet</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete the snippet <strong>{{ deleteSnippetTitle }}</strong> (Language: <strong>{{ deleteSnippetLanguage }}</strong>)?</p>
                    </div>
                    <div class="modal-footer text-end">
                        <button type="button" class="btn btn-danger" @click="deleteSnippet"><i class="fas fa-solid fa-trash-alt"></i>&nbsp;&nbsp;Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <br>

        <div id="single-snippet" class="d-none position-relative row">
            <div class="col-12">
                <a href="#" @click="showHome" class="btn btn-outline-secondary btn-sm position-absolute top-10 start-10 ms-2 mt-2" style="margin-top: 15px !important;"><i class="fas fa-arrow-left"></i> Back</a>
                <div class="position-absolute top-10 end-0 me-3" style="margin-top: 20px !important;">
                    <strong><i class="fas fa-edit"></i></strong> {{ viewSnippet.updated_at }}
                </div>
                <h1 class="text-center mb-4">{{ viewSnippet.title }}</h1>
            </div>
            <hr/>
            <div>
                <div class="position-relative col-12">
                    <div class="position-absolute top-0 end-0 p-2 language-box">
                        {{ viewSnippet.language }}
                    </div>
                    <div id="fullSnippetContent"></div>
                </div>
            </div>
            <hr/>
            <div class="col-12 mb-3 text-end">
                <a class="btn btn-success btn-sm" :href="'api.php?dw=' + viewSnippet.id"><i class="fas fa-solid fa-download"></i></a>
                <button class="btn btn-warning btn-sm" @click="showEditModal(viewSnippet)"><i class="fas fa-edit"></i></button>
                <button class="btn btn-danger btn-sm" @click="confirmDelete(viewSnippet)"><i class="fas fa-trash-alt"></i></button>
            </div>
        </div>

        <div id="main">
            <h1 class="text-center mb-4">Personal Snippets</h1>
            <div class="row mb-3 justify-content-center">
                <div class="col-md-8 d-flex">
                    <input type="text" v-model="searchQuery" class="form-control me-3" placeholder="Search snippets...">
                    <button class="btn btn-primary" @click="showCreateModal"><i class="fas fa-pen-to-square"></i></button>
                </div>
            </div>

            <table class="table table-striped table-hover" id="snippetsTable">
                <thead>
                    <tr>
                        <th @click="sortSnippets('title')">
                            Title&nbsp;
                            <i :class="getSortIcon('title')"></i>
                        </th>
                        <th @click="sortSnippets('language')">
                            Language&nbsp;
                            <i :class="getSortIcon('language')"></i>
                        </th>
                        <th @click="sortSnippets('created_at')">
                            Created At&nbsp;
                            <i :class="getSortIcon('created_at')"></i>
                        </th>
                        <th @click="sortSnippets('updated_at')">
                            Updated At&nbsp;
                            <i :class="getSortIcon('updated_at')"></i>
                        </th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="snippet in filteredSnippets" :key="snippet.id">
                        <td>{{ snippet.title }}</td>
                        <td>{{ snippet.language }}</td>
                        <td>{{ snippet.created_at }}</td>
                        <td>{{ snippet.updated_at }}</td>
                        <td>
                            <a class="btn btn-info btn-sm" :href="'#'+snippet.id"><i class="fas fa-solid fa-eye"></i></a>
                            <button class="btn btn-secondary btn-sm" @click="showViewModal(snippet)"><i class="fas fa-magnifying-glass"></i></button>
                            <a class="btn btn-success btn-sm" :href="'api.php?dw=' + snippet.id"><i class="fas fa-solid fa-download"></i></a>
                            <button class="btn btn-warning btn-sm" @click="showEditModal(snippet)"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm" @click="confirmDelete(snippet)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <br>
        </div>
    </div>

    <script src="assets/jquery-3.7.1/jquery.min.js"></script>
    <script src="assets/bootstrap-5.3.3/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vue.js-2.7.16/vue.min.js"></script>
    <script src="assets/highlight.js-11.10.0/highlight.min.js"></script>
    <script src="assets/highlightjs-line-numbers-2.9.0/highlightjs-line-numbers.min.js"></script>
    <script src="assets/app.js"></script>
</body>
</html>

